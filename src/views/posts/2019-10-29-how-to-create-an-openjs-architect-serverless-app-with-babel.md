---
title: How to create an OpenJS Architect serverless app with Babel and Rollup
image: 'image.png' 
category: uncategorized
description: Author serverless AWS Lambda functions with next-generation JS
author: 'Brian Leroux'
avi: 'brian.jpg'
readtime: '3 mins'
published: 'October 29, 2019'
---

# How to create an OpenJS Architect serverless app with Babel and Rollup

![arc25](arc25.jpg)

In this article weâ€™ll set up an OpenJS Architect project that uses Babel and Rollup to take advantage of next-generation and experimental JS syntax features. Future editions will explore TypeScript and JSX.

Other articles in this series you may be interested in:

- [How to create a bundler-free Architect app with Babel](https://blog.begin.com/how-to-create-a-bundler-free-openjs-architect-serverless-app-with-babel-dc6907859835)
- [How to create an Architect app with TypeScript](https://blog.begin.com/how-to-create-an-openjs-architect-serverless-app-with-typescript-d8549102f73c)

---

Letâ€™s get started! First:

```bash
npm init @architect ./myapp
```

The Architect init script generated one Lambda function in `src/http/get-index/index.js` which weâ€™ll overwrite with code generated by Babel.

For now, define a new JS entry file at `src/http/get-index/entry.js`. Hereâ€™s a basic handler with some modern syntax:

```js
// src/http/get-index/entry.js
export async function handler(req) {
  let response = `
    <h1>Test Babel</h1>
    <pre>
    <b>req?.queryStringParameters?.foo</b> ${req?.queryStringParameters?.foo}
    </pre>
    <hr>
    <pre>${JSON.stringify(req, null, 2)}</pre>
  `
  return {
    headers: {
      'content-type': 'text/html; charset=utf8'
    },
    body: response
  }
}
```

[View code](https://github.com/brianleroux/arc-example-babel/blob/master/src/http/get-index/entry.js)

> Notice: weâ€™re using ES modules syntax! This is not something the default Node.js runtime for Lambda can do nativelyâ€¦ yet!

## Install Babel

Babel is extremely configurable and can be extended much farther than the scope of this tutorial; these are the minimal dependencies required.

```bash
npm i @babel/core @babel/preset-env core-js
```

Bonus: add the optional chaining plugin!

```bash
npm i @babel/plugin-proposal-optional-chaining
```

## Install Rollup

Rollup creates the smallest possible bundle, which also also nice for cloud function coldstarts. We add it and a few plugins for making module interop less of a headache:

```bash
npm i rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve
```

## Configure Rollup

The final boss (already)! We need to configure Rollup to transpile entry.js into index.js. This way both local dev and live deployment will work as weâ€™d expect them to.

```js
// rollup.config.js

import babel from 'rollup-plugin-babel'
import resolve from 'rollup-plugin-node-resolve'
import commonjs from 'rollup-plugin-commonjs'

export default {
  input: 'src/http/get-index/entry.js',
  output: {
    file: 'src/http/get-index/index.js',
    format: 'cjs'
  },
  plugins: [
    resolve(),
    babel({
      exclude: 'node_modules/**',
      presets: [[
        '@babel/env', {
          modules: 'false',
          targets: {node: 10},
          useBuiltIns: 'usage',
          corejs: 3
        }
      ]],
      plugins: ["@babel/plugin-proposal-optional-chaining"]
    }),
    commonjs()
  ]
}
```

[View code](https://github.com/brianleroux/arc-example-babel/blob/master/rollup.config.js)

We wonâ€™t dig into the config too much, but youâ€™re certainly welcome to! Suffice to say, this will generate a CommonJS module that AWS Lambda can run.

## Configure npm scripts

Add the classic `npm start` and `npm run build` commands:

```json
"scripts": {
    "build": "npx rollup -c",
    "start": "npm run build && npx arc sandbox",
    "deploy": "npm run build && npx arc deploy"
  },
```
Work locally, then deploy to AWS when youâ€™re happy with your app

## Set up CI/CD

![arc31](arc31.png)

Now that everything is working locally we can set up [Begin](https://begin.com/) to deploy our code from GitHub whenever we commit. Login to Begin with your GitHub account, click `New app`, and scroll to the big `Import app` button. (My first build was completed in 11.474 seconds!)

You can use the GitHub repo [brianleroux/arc-example-babel](https://github.com/brianleroux/arc-example-babel) to get started.

## Thatâ€™s it!

Now youâ€™re up and running with some serverless Babel. Hereâ€™s another example of enabling [optional chaining](https://github.com/tc39/proposal-optional-chaining) on a request objectâ€™s `queryStringParameter` property â€” something that would normally require nested accessors:

![arc32](arc32.png)

`req.queryStringParameters && req.queryStringParameters.foo` no more!

You can find the [full source code for this tutorial here](https://github.com/brianleroux/arc-example-babel).

Stay tuned: weâ€™ll look at combining AWS Lambda with TypeScript and JSX next!

## Next steps

- Sign up for [Begin.com](https://begin.com/), score your username, and make an app!
- Star [architect/architect on GitHub!](https://github.com/architect/architect) ðŸŒŸ
